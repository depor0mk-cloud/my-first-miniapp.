<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hakos Star Elite</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #020617;
            --glass: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.15);
            --premium: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
            --gold: #ffb000;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
            color: white; margin: 0; height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden; padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom);
        }

        /* –®–∞–ø–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π –ú–∞–≥–∞–∑–∏–Ω–∞ */
        .header { width: 100%; display: flex; justify-content: flex-end; padding: 10px 0; }
        .menu-btn {
            background: var(--glass); backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); color: white;
            padding: 8px 16px; border-radius: 12px; font-weight: bold;
        }

        /* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–π —Å—á–µ—Ç */
        .score-card {
            background: var(--glass); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 20px 40px; border-radius: 30px;
            text-align: center; margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-width: 200px; cursor: pointer;
        }

        #score {
            font-size: 56px; font-weight: 900; margin: 0;
            background: linear-gradient(to bottom, #fff, #a855f7);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .stars-count { color: var(--gold); font-weight: bold; font-size: 18px; margin-top: 5px; }

        /* –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .game-area { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; }
        
        #main-btn {
            width: 220px; height: 220px; border-radius: 50%;
            background: var(--premium); display: flex; justify-content: center; align-items: center;
            border: 4px solid rgba(255,255,255,0.2);
            box-shadow: 0 0 50px rgba(168, 85, 247, 0.3);
            transition: transform 0.05s; cursor: pointer;
        }
        #main-btn.combo-active { box-shadow: 0 0 70px var(--gold); background: var(--gold); }
        #main-btn:active { transform: scale(0.92); }

        .star-svg { width: 110px; fill: white; }

        /* –®–∫–∞–ª–∞ –ö–æ–º–±–æ */
        .combo-container { width: 80%; height: 10px; background: var(--glass); border-radius: 5px; margin-top: 40px; overflow: hidden; border: 1px solid var(--glass-border); }
        #combo-fill { width: 0%; height: 100%; background: var(--premium); transition: width 0.2s linear; }
        #combo-fill.max { background: var(--gold); box-shadow: 0 0 10px var(--gold); }

        /* –ú–∞–≥–∞–∑–∏–Ω (–ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é) */
        .side-menu {
            position: fixed; top: 0; right: -100%; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(30px);
            z-index: 1000; transition: 0.4s; padding: 60px 20px;
        }
        .side-menu.active { right: 0; }
        .close-area { color: #a855f7; font-weight: bold; margin-bottom: 30px; }

        .item { background: var(--glass); padding: 15px; border-radius: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass-border); }
        .buy-btn { background: white; color: black; border: none; padding: 10px 15px; border-radius: 12px; font-weight: bold; }
        .buy-btn:disabled { opacity: 0.3; }
    </style>
</head>
<body>

    <div class="header">
        <button class="menu-btn" onclick="toggleShop(true)">–ú–ê–ì–ê–ó–ò–ù</button>
    </div>

    <div class="score-card" onclick="askPromo()">
        <p style="margin:0; font-size:12px; color:#94a3b8; font-weight:bold;">SCORE</p>
        <h1 id="score">0</h1>
        <div class="stars-count">‚ú® –ó–≤–µ–∑–¥—ã: <span id="stars-val">0</span></div>
    </div>

    <div class="game-area">
        <div id="main-btn" onclick="handleTap()">
            <svg class="star-svg" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></svg>
        </div>

        <div id="combo-text" style="margin-top:20px; font-weight:900; height:20px;"></div>
        <div class="combo-container">
            <div id="combo-fill"></div>
        </div>
    </div>

    <div id="shop" class="side-menu">
        <div class="close-area" onclick="toggleShop(false)">‚Üê –ù–ê–ó–ê–î –í –ò–ì–†–£</div>
        <div id="shop-content"></div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let score = parseFloat(localStorage.getItem('h_score')) || 0;
        let pps = parseFloat(localStorage.getItem('h_pps')) || 0;
        let power = parseInt(localStorage.getItem('h_power')) || 1;
        let stars = parseInt(localStorage.getItem('h_stars')) || 0;
        
        let combo = 0;
        let comboTimer = null;

        const shopItems = [
            { id: 'c1', name: '–°–∏–ª–∞ –∫–ª–∏–∫–∞ +2', base: 150, type: 'power', val: 2 },
            { id: 'p1', name: '–ú–∏–∫—Ä–æ-—Ñ–µ—Ä–º–∞', base: 50, type: 'pps', val: 0.5 },
            { id: 'p2', name: '–°–µ—Ä–≤–µ—Ä', base: 500, type: 'pps', val: 5 }
        ];

        let costs = JSON.parse(localStorage.getItem('h_costs')) || {};
        shopItems.forEach(i => { if(!costs[i.id]) costs[i.id] = i.base; });

        function handleTap() {
            let multiplier = (combo >= 100) ? 3 : 1;
            score += (power * multiplier);
            
            // –®–∞–Ω—Å –Ω–∞ –∑–≤–µ–∑–¥—É 0.09%
            if (Math.random() < 0.0009) {
                stars++;
                if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                alert("–†–ï–î–ö–û–°–¢–¨! –¢—ã –Ω–∞—à–µ–ª –ó–≤–µ–∑–¥—É ‚ú®");
            }

            // –õ–æ–≥–∏–∫–∞ –∫–æ–º–±–æ
            combo = Math.min(combo + 5, 100);
            resetComboTimer();
            
            updateUI();
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        }

        function resetComboTimer() {
            clearTimeout(comboTimer);
            comboTimer = setInterval(() => {
                combo = Math.max(combo - 2, 0);
                updateUI();
                if(combo === 0) clearInterval(comboTimer);
            }, 100);
        }

        function askPromo() {
            let code = prompt("–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥:");
            if(code === 'hk') {
                if(localStorage.getItem('promo_hk')) return alert("–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!");
                score += 27;
                localStorage.setItem('promo_hk', 'true');
                updateUI();
                alert("–ó–∞—á–∏—Å–ª–µ–Ω–æ 27 –æ—á–∫–æ–≤!");
            }
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score);
            document.getElementById('stars-val').innerText = stars;
            
            let fill = document.getElementById('combo-fill');
            fill.style.width = combo + "%";
            
            let btn = document.getElementById('main-btn');
            let txt = document.getElementById('combo-text');
            
            if(combo >= 100) {
                fill.classList.add('max');
                btn.classList.add('combo-active');
                txt.innerText = "COMBO X3 üî•";
                txt.style.color = "#ffb000";
            } else {
                fill.classList.remove('max');
                btn.classList.remove('combo-active');
                txt.innerText = combo > 20 ? "–¢–ê–ü–ê–ô –ë–´–°–¢–†–ï–ï!" : "";
                txt.style.color = "white";
            }
        }

        function toggleShop(open) {
            document.getElementById('shop').classList.toggle('active', open);
            if(open) renderShop();
        }

        function renderShop() {
            let html = '';
            shopItems.forEach(item => {
                let cost = Math.floor(costs[item.id]);
                html += `<div class="item">
                    <div><b>${item.name}</b><br><small>–¶–µ–Ω–∞: ${cost}</small></div>
                    <button class="buy-btn" ${score < cost ? 'disabled' : ''} onclick="buy('${item.id}')">–ö–£–ü–ò–¢–¨</button>
                </div>`;
            });
            document.getElementById('shop-content').innerHTML = html;
        }

        function buy(id) {
            let item = shopItems.find(i => i.id === id);
            if(score >= costs[id]) {
                score -= costs[id];
                if(item.type === 'power') power += item.val;
                else pps += item.val;
                costs[id] *= 1.6;
                save(); updateUI(); renderShop();
            }
        }

        function save() {
            localStorage.setItem('h_score', score);
            localStorage.setItem('h_pps', pps);
            localStorage.setItem('h_power', power);
            localStorage.setItem('h_stars', stars);
            localStorage.setItem('h_costs', JSON.stringify(costs));
        }

        setInterval(() => { score += pps; updateUI(); save(); }, 1000);
        updateUI();
    </script>
</body>
</html>
