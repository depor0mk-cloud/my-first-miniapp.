<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hakos Star Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #020617;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12);
            --premium: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
            --gold: #ffb000;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
            color: white; margin: 0; height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden; padding: env(safe-area-inset-top) 20px;
        }

        /* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–π —Å—á–µ—Ç - –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å–≤–µ—Ä—Ö—É */
        .score-wrapper { margin-top: 60px; z-index: 5; }
        .score-card {
            background: var(--glass); backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            padding: 15px 35px; border-radius: 24px;
            text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }

        #score {
            font-size: 50px; font-weight: 900; margin: 0;
            background: linear-gradient(to bottom, #fff, #a855f7);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .stars-display { color: var(--gold); font-size: 14px; font-weight: bold; margin-top: 4px; }

        /* –ö–Ω–æ–ø–∫–∞ –ú–∞–≥–∞–∑–∏–Ω–∞ - –û–ü–£–©–ï–ù–ê –Ω–∏–∂–µ —Å—á–µ—Ç–∞ */
        .nav-bar { width: 100%; display: flex; justify-content: center; margin-top: 20px; z-index: 10; }
        .menu-trigger {
            background: var(--glass); border: 1px solid var(--glass-border);
            color: white; padding: 10px 24px; border-radius: 14px;
            font-weight: 800; font-size: 14px; letter-spacing: 1px; backdrop-filter: blur(10px);
        }

        /* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
        .game-container { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; }
        
        #main-target {
            width: 210px; height: 210px; border-radius: 50%;
            background: var(--premium); display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 40px rgba(168, 85, 247, 0.3);
            transition: transform 0.05s; cursor: pointer; border: 3px solid rgba(255,255,255,0.2);
        }
        #main-target.active-x3 { background: var(--gold); box-shadow: 0 0 60px var(--gold); }
        #main-target:active { transform: scale(0.9); }
        .star-icon { width: 100px; fill: white; filter: drop-shadow(0 0 10px white); }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
        .combo-box { width: 70%; margin-top: 30px; text-align: center; }
        .bar-bg { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; margin-top: 10px; }
        #bar-fill { width: 0%; height: 100%; background: var(--premium); transition: width 0.1s linear; }
        #bar-fill.cooldown { background: #475569 !important; }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .side-panel {
            position: fixed; top: 0; right: -100%; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.98); backdrop-filter: blur(30px);
            z-index: 1000; transition: 0.3s ease-out; padding: 60px 25px;
        }
        .side-panel.open { right: 0; }
        .item-row { background: var(--glass); padding: 16px; border-radius: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass-border); }
        .btn-buy { background: white; color: black; border: none; padding: 10px 18px; border-radius: 10px; font-weight: bold; }
        
        .promo-section { margin-top: 30px; border-top: 1px solid var(--glass-border); padding-top: 20px; }
    </style>
</head>
<body>

    <div class="score-wrapper">
        <div class="score-card">
            <div style="font-size: 10px; color: #94a3b8; letter-spacing: 2px;">VAULT</div>
            <h1 id="score">0</h1>
            <div class="stars-display">‚ú® STARS: <span id="stars-count">0</span></div>
        </div>
    </div>

    <div class="nav-bar">
        <button class="menu-trigger" onclick="setShop(true)">–û–¢–ö–†–´–¢–¨ –ú–ê–ì–ê–ó–ò–ù</button>
    </div>

    <div class="game-container">
        <div id="main-target" onclick="doTap()">
            <svg class="star-icon" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></svg>
        </div>

        <div class="combo-box">
            <div id="status-label" style="font-size: 12px; font-weight: bold; color: #94a3b8;">TAP TO BOOST</div>
            <div class="bar-bg">
                <div id="bar-fill"></div>
            </div>
        </div>
    </div>

    <div id="shop-ui" class="side-panel">
        <div style="color: #a855f7; margin-bottom: 20px; cursor:pointer;" onclick="setShop(false)">‚Üê –í–ï–†–ù–£–¢–¨–°–Ø</div>
        <h2>–ú–ê–ì–ê–ó–ò–ù</h2>
        <div id="items-list"></div>
        
        <div class="promo-section">
            <button class="menu-trigger" style="width:100%" onclick="enterPromo()">–í–í–ï–°–¢–ò –ü–†–û–ú–û–ö–û–î</button>
        </div>
    </div>

    <script>
        let score = parseFloat(localStorage.getItem('h_score')) || 0;
        let stars = parseInt(localStorage.getItem('h_stars')) || 0;
        let power = parseInt(localStorage.getItem('h_power')) || 1;
        let pps = parseFloat(localStorage.getItem('h_pps')) || 0;

        let combo = 0;
        let isX3 = false;
        let isCooldown = false;
        let comboDecay = null;

        const items = [
            { id: 'i1', name: '–ú–æ—â–Ω—ã–π –∫–ª–∏–∫', cost: 150, type: 'p', val: 2 },
            { id: 'i2', name: '–ê–≤—Ç–æ-–º–∞–π–Ω–µ—Ä', cost: 100, type: 's', val: 1 }
        ];
        let currentCosts = JSON.parse(localStorage.getItem('h_costs')) || { i1: 150, i2: 100 };

        function doTap() {
            if (isCooldown) {
                score += power; // –û–±—ã—á–Ω—ã–π –∫–ª–∏–∫ –≤–æ –≤—Ä–µ–º—è –ö–î
            } else {
                let m = isX3 ? 3 : 1;
                score += (power * m);
                if (!isX3) {
                    combo = Math.min(combo + 4, 100);
                    if (combo >= 100) startX3();
                }
            }
            
            if (Math.random() < 0.0009) {
                stars++;
                window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            }
            
            updateUI();
            window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
        }

        function startX3() {
            isX3 = true;
            combo = 100;
            setTimeout(() => {
                isX3 = false;
                combo = 0;
                startCooldown();
            }, 10000); // 10 —Å–µ–∫—É–Ω–¥ –¥–ª–∏—Ç—Å—è x3
        }

        function startCooldown() {
            isCooldown = true;
            let cdEnd = Date.now() + (30 * 60 * 1000); // 30 –º–∏–Ω—É—Ç
            localStorage.setItem('cd_end', cdEnd);
            checkCooldown();
        }

        function checkCooldown() {
            let end = localStorage.getItem('cd_end');
            if (end && Date.now() < end) {
                isCooldown = true;
                let remaining = Math.ceil((end - Date.now()) / 1000 / 60);
                document.getElementById('status-label').innerText = `–ö–î: ${remaining} –ú–ò–ù`;
                document.getElementById('bar-fill').classList.add('cooldown');
                document.getElementById('bar-fill').style.width = "100%";
                setTimeout(checkCooldown, 30000);
            } else {
                isCooldown = false;
                document.getElementById('bar-fill').classList.remove('cooldown');
                document.getElementById('status-label').innerText = "–ì–û–¢–û–í –ö –ë–£–°–¢–£";
                localStorage.removeItem('cd_end');
            }
        }

        function enterPromo() {
            let p = prompt("CODE:");
            if(p === 'hk' && !localStorage.getItem('p_hk')) {
                score += 27;
                localStorage.setItem('p_hk', '1');
                alert("OK! +27");
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score);
            document.getElementById('stars-count').innerText = stars;
            if (!isCooldown) {
                document.getElementById('bar-fill').style.width = combo + "%";
                document.getElementById('status-label').innerText = isX3 ? "üî• –†–ï–ñ–ò–ú X3 üî•" : "TAP FAST";
                document.getElementById('main-target').className = isX3 ? "active-x3" : "";
            }
        }

        function setShop(o) {
            document.getElementById('shop-ui').classList.toggle('open', o);
            if(o) {
                let h = '';
                items.forEach(i => {
                    h += `<div class="item-row">
                        <div><b>${i.name}</b><br><small>${currentCosts[i.id]} PTS</small></div>
                        <button class="btn-buy" onclick="buy('${i.id}')" ${score < currentCosts[i.id] ? 'disabled' : ''}>BUY</button>
                    </div>`;
                });
                document.getElementById('items-list').innerHTML = h;
            }
        }

        function buy(id) {
            let i = items.find(x => x.id === id);
            if(score >= currentCosts[id]) {
                score -= currentCosts[id];
                if(i.type === 'p') power += i.val; else pps += i.val;
                currentCosts[id] *= 1.6;
                save(); updateUI(); setShop(true);
            }
        }

        function save() {
            localStorage.setItem('h_score', score);
            localStorage.setItem('h_stars', stars);
            localStorage.setItem('h_power', power);
            localStorage.setItem('h_pps', pps);
            localStorage.setItem('h_costs', JSON.stringify(currentCosts));
        }

        setInterval(() => { score += pps; updateUI(); save(); }, 1000);
        checkCooldown();
        updateUI();
    </script>
</body>
</html>
