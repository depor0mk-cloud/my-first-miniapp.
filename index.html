<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hakos Premium Glass</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #020617;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.15);
            --accent: #a855f7;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
            color: white;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            padding-top: env(safe-area-inset-top);
        }

        /* Кнопка магазина сверху */
        .header-nav {
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: flex-end;
            z-index: 100;
        }

        .menu-trigger {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 12px 20px;
            border-radius: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Счет */
        #score-container {
            text-align: center;
            margin-top: 20px;
            z-index: 10;
        }

        #score {
            font-size: 80px;
            font-weight: 900;
            margin: 0;
            background: linear-gradient(to bottom, #fff, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            drop-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
        }

        /* Центральная Кнопка-Звезда */
        .main-btn-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #star-btn {
            width: 240px;
            height: 240px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.8), rgba(99, 102, 241, 0.8));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 50px rgba(168, 85, 247, 0.3), inset 0 0 30px rgba(255,255,255,0.2);
            transition: transform 0.05s, box-shadow 0.2s;
        }

        #star-btn:active { transform: scale(0.9); }

        .star-svg { width: 120px; fill: white; filter: drop-shadow(0 0 15px white); }

        /* Боковое меню (Магазин) */
        .side-menu {
            position: fixed;
            top: 0; right: -100%;
            width: 85%; height: 100%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(40px); /* Максимальное стекло */
            border-left: 1px solid var(--glass-border);
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 200;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
        }

        .side-menu.active { right: 0; }

        .close-menu { margin-bottom: 20px; color: var(--accent); font-weight: bold; cursor: pointer; }

        .shop-scroll { overflow-y: auto; flex-grow: 1; padding-right: 5px; }

        .item-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .buy-btn {
            background: #fff;
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 12px;
            font-weight: 900;
            cursor: pointer;
        }

        .buy-btn:disabled { background: #475569; color: #94a3b8; }

        .stat-badge { font-size: 14px; color: #94a3b8; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="header-nav">
        <button class="menu-trigger" onclick="toggleMenu(true)">МАГАЗИН</button>
    </div>

    <div id="score-container">
        <div class="stat-badge" id="click-info">Клик: +1</div>
        <h1 id="score">0</h1>
        <div class="stat-badge" id="pps-info">Доход: 0/сек</div>
    </div>

    <div class="main-btn-area">
        <div id="star-btn" onclick="handleTap()">
            <svg class="star-svg" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></svg>
        </div>
    </div>

    <div id="shop" class="side-menu">
        <div class="close-menu" onclick="toggleMenu(false)">← ЗАКРЫТЬ</div>
        <h2>Улучшения</h2>
        <div class="shop-scroll" id="shop-list">
            </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let score = parseFloat(localStorage.getItem('g_score')) || 0;
        let pps = parseFloat(localStorage.getItem('g_pps')) || 0;
        let power = parseInt(localStorage.getItem('g_power')) || 1;

        const shopItems = [
            { id: 'p1', name: 'Сила клика +2', base: 150, type: 'click', val: 2 },
            { id: 'p2', name: 'Сила клика +10', base: 1000, type: 'click', val: 10 },
            { id: 'm1', name: 'Мини-ферма', base: 50, type: 'pps', val: 0.5 },
            { id: 'm2', name: 'Видеокарта', base: 400, type: 'pps', val: 3 },
            { id: 'm3', name: 'Сервер', base: 2500, type: 'pps', val: 15 },
            { id: 'm4', name: 'Квантовый ПК', base: 15000, type: 'pps', val: 80 }
        ];

        let costs = JSON.parse(localStorage.getItem('g_costs')) || {};
        shopItems.forEach(i => { if(!costs[i.id]) costs[i.id] = i.base; });

        function toggleMenu(show) {
            document.getElementById('shop').classList.toggle('active', show);
            if(show) renderShop();
        }

        function renderShop() {
            let html = '';
            shopItems.forEach(item => {
                let cost = Math.floor(costs[item.id]);
                html += `
                    <div class="item-card">
                        <div>
                            <b>${item.name}</b><br>
                            <small>${item.type === 'click' ? '+'+item.val+' к клику' : '+'+item.val+'/сек'}</small><br>
                            <span style="color:var(--accent)">${cost} очков</span>
                        </div>
                        <button class="buy-btn" ${score < cost ? 'disabled' : ''} onclick="buy('${item.id}')">КУПИТЬ</button>
                    </div>
                `;
            });
            document.getElementById('shop-list').innerHTML = html;
        }

        function handleTap() {
            score += power;
            updateUI();
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        }

        function buy(id) {
            let item = shopItems.find(i => i.id === id);
            let cost = costs[id];
            if(score >= cost) {
                score -= cost;
                if(item.type === 'click') power += item.val;
                else pps += item.val;
                costs[id] *= 1.6; // Инфляция
                save();
                updateUI();
                renderShop();
            }
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score);
            document.getElementById('click-info').innerText = `Клик: +${power}`;
            document.getElementById('pps-info').innerText = `Доход: ${pps.toFixed(1)}/сек`;
        }

        function save() {
            localStorage.setItem('g_score', score);
            localStorage.setItem('g_pps', pps);
            localStorage.setItem('g_power', power);
            localStorage.setItem('g_costs', JSON.stringify(costs));
            localStorage.setItem('g_last', Date.now());
        }

        setInterval(() => {
            score += pps;
            updateUI();
            save();
        }, 1000);

        updateUI();
    </script>
</body>
</html>
