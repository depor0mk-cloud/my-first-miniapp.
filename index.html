<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hakos Star: Final Layout</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #020617;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12);
            --premium: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
            --gold: #ffb000;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
            color: white; margin: 0; height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden; 
            /* –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –û–ü–£–°–¢–ò–õ –í–°–Å –í–ù–ò–ó */
            padding-top: 300px; 
        }

        /* –£–∑–∫–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å—á–µ—Ç–∞ */
        .score-card {
            background: var(--glass); backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            padding: 15px 20px; border-radius: 24px;
            text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            margin-bottom: 15px; 
            width: 75%; /* –ö—Ä–∞—è —Ç–µ–ø–µ—Ä—å —É–∂–µ */
        }

        #score {
            font-size: 40px; font-weight: 900; margin: 0;
            background: linear-gradient(to bottom, #fff, #a855f7);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .stats-row { font-size: 11px; color: #94a3b8; font-weight: bold; margin-top: 4px; letter-spacing: 1px; }

        .menu-trigger {
            background: var(--glass); border: 1px solid var(--glass-border);
            color: white; padding: 12px 30px; border-radius: 16px;
            font-weight: 800; font-size: 13px; backdrop-filter: blur(10px);
            margin-bottom: 25px;
        }

        .game-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; width: 100%; }
        
        #main-target {
            width: 180px; height: 180px; border-radius: 50%;
            background: var(--premium); display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
            transition: all 0.2s ease; cursor: pointer; border: 4px solid rgba(255,255,255,0.2);
        }
        
        #main-target.overheating { box-shadow: 0 0 50px var(--danger); border-color: var(--danger); }
        #main-target.broken { background: #1e293b !important; border-color: #475569; cursor: default; }
        #main-target.active-x3 { background: var(--gold) !important; box-shadow: 0 0 60px var(--gold); }
        
        #main-target:active:not(.broken) { transform: scale(0.92); }
        .star-icon { width: 80px; fill: white; }

        .combo-box { width: 70%; margin-top: 20px; text-align: center; }
        .bar-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; margin-top: 10px; }
        #bar-fill { width: 0%; height: 100%; background: var(--premium); transition: width 0.1s linear; }
        #bar-fill.cooldown { background: #475569 !important; }

        .side-panel {
            position: fixed; top: 0; right: -100%; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.98); backdrop-filter: blur(35px);
            z-index: 1000; transition: 0.3s ease-out; 
            padding: 130px 25px 40px; 
        }
        .side-panel.open { right: 0; }
        .shop-scroll { height: 50vh; overflow-y: auto; }
        .item-row { background: var(--glass); padding: 14px; border-radius: 16px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass-border); }
        .btn-buy { background: white; color: black; border: none; padding: 10px 14px; border-radius: 10px; font-weight: bold; font-size: 11px; }
    </style>
</head>
<body>

    <div class="score-card">
        <h1 id="score">0</h1>
        <div class="stats-row">‚ú® –ó–í–ï–ó–î–´: <span id="stars-count">0</span></div>
        <div class="stats-row" id="pps-display" style="color: #a855f7;">–ü–†–ò–ë–´–õ–¨: 0.0/–°–ï–ö</div>
    </div>

    <button class="menu-trigger" onclick="setShop(true)">–ú–ê–ì–ê–ó–ò–ù –ò –ö–û–î–´</button>

    <div class="game-container">
        <div id="main-target" onclick="doTap()">
            <div id="target-content">
                <svg class="star-icon" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></svg>
            </div>
        </div>

        <div class="combo-box">
            <div id="status-label" style="font-size: 10px; font-weight: bold; color: #94a3b8; text-transform: uppercase;">–°–ò–°–¢–ï–ú–ê –ù–û–†–ú–ê</div>
            <div class="bar-bg">
                <div id="bar-fill"></div>
            </div>
        </div>
    </div>

    <div id="shop-ui" class="side-panel">
        <div style="color: #a855f7; margin-bottom: 30px; cursor:pointer; font-weight: bold;" onclick="setShop(false)">‚Üê –ù–ê–ó–ê–î</div>
        <div class="shop-scroll" id="items-list"></div>
        <button class="menu-trigger" style="width:100%; margin-top: 20px;" onclick="enterPromo()">–í–í–ï–°–¢–ò –ü–†–û–ú–û–ö–û–î</button>
    </div>

    <script>
        let score = parseFloat(localStorage.getItem('h_score')) || 0;
        let stars = parseInt(localStorage.getItem('h_stars')) || 0;
        let power = parseInt(localStorage.getItem('h_power')) || 1;
        let pps = parseFloat(localStorage.getItem('h_pps')) || 0;

        let combo = 0;
        let isX3 = false;
        let isCooldown = false;
        let isBroken = false;
        let tapCount = 0;
        let lastTapTime = Date.now();

        const items = [
            { id: 'i1', name: '–°–∏–ª–∞ –∫–ª–∏–∫–∞ +2', cost: 150, type: 'p', val: 2 },
            { id: 'i2', name: '–°–∏–ª–∞ –∫–ª–∏–∫–∞ +10', cost: 1200, type: 'p', val: 10 },
            { id: 's1', name: '–ü—Ä–æ–∫—Å–∏-—É–∑–µ–ª', cost: 50, type: 's', val: 0.5 },
            { id: 's2', name: '–ú–∞–π–Ω–µ—Ä v1', cost: 400, type: 's', val: 4 },
            { id: 's3', name: '–î–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä', cost: 2000, type: 's', val: 25 },
            { id: 's4', name: '–ö–≤–∞–Ω—Ç–æ–≤—ã–π –ü–ö', cost: 10000, type: 's', val: 150 }
        ];

        let currentCosts = JSON.parse(localStorage.getItem('h_costs')) || {};
        items.forEach(i => { if(!currentCosts[i.id]) currentCosts[i.id] = i.cost; });

        function doTap() {
            if (isBroken) return;
            let now = Date.now();
            let delta = now - lastTapTime;
            lastTapTime = now;
            tapCount = delta < 150 ? tapCount + 1 : 0;
            if (tapCount > 18) {
                document.getElementById('main-target').classList.add('overheating');
                if (Math.random() < 0.20) return breakButton();
            } else {
                document.getElementById('main-target').classList.remove('overheating');
            }
            if (isCooldown) { score += power; } else {
                let m = isX3 ? 3 : 1;
                score += (power * m);
                if (!isX3) {
                    combo = Math.min(combo + 4, 100);
                    if (combo >= 100) startX3();
                }
            }
            if (Math.random() < 0.0009) stars++;
            updateUI();
            window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
        }

        function startX3() {
            isX3 = true;
            document.getElementById('main-target').classList.add('active-x3');
            setTimeout(() => {
                isX3 = false; combo = 0;
                document.getElementById('main-target').classList.remove('active-x3');
                startCooldown();
            }, 10000);
        }

        function startCooldown() {
            isCooldown = true;
            let cdEnd = Date.now() + (30 * 60 * 1000);
            localStorage.setItem('cd_end', cdEnd);
            checkCooldown();
        }

        function checkCooldown() {
            let end = localStorage.getItem('cd_end');
            if (end && Date.now() < end) {
                isCooldown = true;
                let rem = Math.ceil((end - Date.now()) / 1000 / 60);
                document.getElementById('status-label').innerText = `–ö–î: ${rem} –ú–ò–ù`;
                document.getElementById('bar-fill').classList.add('cooldown');
                document.getElementById('bar-fill').style.width = "100%";
                setTimeout(checkCooldown, 30000);
            } else {
                isCooldown = false;
                document.getElementById('bar-fill').classList.remove('cooldown');
                document.getElementById('status-label').innerText = "–ì–û–¢–û–í –ö –ë–£–°–¢–£";
                localStorage.removeItem('cd_end');
            }
        }

        function breakButton() {
            isBroken = true;
            document.getElementById('main-target').className = "broken";
            document.getElementById('target-content').innerHTML = "<span style='font-size:40px;'>üõ†</span>";
            localStorage.setItem('repair_end', Date.now() + (5 * 60 * 1000));
            checkRepair();
        }

        function checkRepair() {
            let end = localStorage.getItem('repair_end');
            if (end && Date.now() < end) {
                isBroken = true;
                let rem = Math.ceil((end - Date.now()) / 1000);
                document.getElementById('status-label').innerText = `–†–ï–ú–û–ù–¢: ${Math.floor(rem/60)}–º ${rem%60}—Å`;
                setTimeout(checkRepair, 1000);
            } else {
                isBroken = false;
                localStorage.removeItem('repair_end');
                document.getElementById('main-target').className = "";
                document.getElementById('target-content').innerHTML = '<svg class="star-icon" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></svg>';
                updateUI();
            }
        }

        function setShop(o) {
            document.getElementById('shop-ui').classList.toggle('open', o);
            if(o) {
                let h = '';
                items.forEach(i => {
                    h += `<div class="item-row">
                        <div><b>${i.name}</b><br><small>+${i.val} ${i.type === 'p' ? '–∫ –∫–ª–∏–∫—É' : '/—Å–µ–∫'}</small><br><b>${Math.floor(currentCosts[i.id])} –û–ß–ö–ò</b></div>
                        <button class="btn-buy" onclick="buy('${i.id}')" ${score < currentCosts[i.id] ? 'disabled' : ''}>–ö–£–ü–ò–¢–¨</button>
                    </div>`;
                });
                document.getElementById('items-list').innerHTML = h;
            }
        }

        function buy(id) {
            let i = items.find(x => x.id === id);
            if(score >= currentCosts[id]) {
                score -= currentCosts[id];
                if(i.type === 'p') power += i.val; else pps += i.val;
                currentCosts[id] *= 1.6;
                save(); updateUI(); setShop(true);
            }
        }

        function enterPromo() {
            let p = prompt("–ö–û–î:");
            if(p === 'hk' && !localStorage.getItem('p_hk')) {
                score += 27; localStorage.setItem('p_hk', '1');
                alert("–û–ö! +27"); updateUI();
            }
        }

        function save() {
            localStorage.setItem('h_score', score);
            localStorage.setItem('h_stars', stars);
            localStorage.setItem('h_power', power);
            localStorage.setItem('h_pps', pps);
            localStorage.setItem('h_costs', JSON.stringify(currentCosts));
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score);
            document.getElementById('stars-count').innerText = stars;
            document.getElementById('pps-display').innerText = `–ü–†–ò–ë–´–õ–¨: ${pps.toFixed(1)}/–°–ï–ö`;
            if (!isCooldown && !isBroken) document.getElementById('bar-fill').style.width = combo + "%";
        }

        setInterval(() => { if (pps > 0) { score += pps; updateUI(); save(); } }, 1000);
        checkCooldown(); checkRepair(); updateUI();
    </script>
</body>
</html>
